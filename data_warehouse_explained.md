# شرح مبسّط لمعماریة الداتا ويرهاوس (DW) حتى طبقة التخزين

هدف الداتا ويرهاوس هو تجميع بيانات التشغيل من مصادر متعددة بطريقة منظّمة وقابلة للتحليل على المدى الطويل، مع ضمان الجودة، الاتساق، والأداء.

1) طبقات المعمارية الأساسية
- مصادر البيانات: قواعد تشغيلية (ERP/MES/SCADA/IoT)، ملفات CSV/JSON، واجهات APIs، وسجلات الأحداث.
- منطقة الهبوط (Landing): تستقبل البيانات كما هي من المصدر بدون تحويلات كبيرة، للحفاظ على الأثر الخام.
- منطقة التحضير (Staging): تنظيف أولي، تسوية الحقول، كشف المشاكل، وإعداد بيانات جاهزة للتحميل.
- ODS (Operational Data Store): صورة شبه آنية للبيانات التشغيلية الموحّدة لاستخدامات تشغيلية/تقارير خفيفة.
- EDW (Enterprise Data Warehouse): المخزن المركزي الموحّد طويل الأجل المبني على نماذج بُعدية/موضوعية.
- Data Marts (اختياري): أجزاء موضوعية موجهة للأعمال (إنتاج، صيانة، جودة) مبسطة لأداء أفضل.

2) منهجيات النمذجة
- Kimball (البُعدية): نجمة/ثلج، جداول وقائع + أبعاد، مناسبة للتقارير والأداء.
- Inmon (المؤسسية): نموذج موحّد عالي التطبيع في EDW ثم تحويلات إلى ماركات بُعدية.
- الأبعاد: SCD Type 1/2/3 لإدارة تغيّر سمات الكيانات مع الزمن.
- الوقائع: قياسات رقمية مرتبطة بالمفاتيح البديلة للأبعاد، مع الوقت/الحبيبية المناسبة.

3) تدفقات التحميل: ETL vs ELT
- ETL: الاستخراج → التحويل خارج المخزن → التحميل.
- ELT: الاستخراج → التحميل أولًا → التحويل داخل محرك التخزين (يستفيد من قدرات المعالجة).
- دفعات/شبه آنية/لحظية: اختيار حسب احتياج العمل (Batch, Micro-batch, Streaming) مع CDC لتتبّع التغييرات.

4) طبقة التخزين (Storage Layer)
- قواعد عمودية/سحابية: Snowflake, Redshift, BigQuery, ClickHouse، أو مستودعات تقليدية محكومة (PostgreSQL/SQL Server) حسب المتطلبات.
- Data Lake (اختياري): تخزين ملفات منسّقة (Parquet/ORC/Avro) على S3/Azure Blob/HDFS لخفض التكلفة والمرونة.
- تنسيقات مفضّلة: Parquet/ORC لضغط وقراءة عمودية أسرع؛ تجنّب CSV في التخزين طويل الأجل.

5) التصميم المادي للأداء والقابلية للتوسّع
- التقسيم (Partitioning): حسب التاريخ/المصنع/الخط لتقليل نطاق القراءة.
- التجمّع/الكلستر (Clustering/Z-Order): لترتيب الأعمدة عالية الانتقائية.
- الفهارس/الإحصاءات: تحسين الانتقاء؛ تحديث الإحصاءات دوريًا.
- الضغط: Snappy/ZSTD، مع اختيار الترميز الأنسب لكل عمود.
- الجداول المادية/الموادية (Materialized Views): تسريع الاستعلامات الثقيلة بتحديثات مجدولة.

6) الحوكمة والجودة والأمن
- قواعد تعريفية موحّدة للأسماء والأنواع.
- اختبارات جودة البيانات: اكتمال، التناسق المرجعي، القيم الخارجة، والازدواجات.
- كتالوج وميتاداتا: توثيق الجداول، الأبعاد، مؤشرات الجودة، وسلاسل النسب (Lineage).
- الأمن والامتثال: صلاحيات دقيقة، تشفير، تدقيق الوصول، وسياسات الاحتفاظ.
- النسخ الاحتياطي والتعافي: نقاط استعادة، نسخ متقاطع المناطق/المنصات.

7) خطة تنفيذ "حتى التخزين"
- تعريف المصادر والمتطلبات التحليلية وحبيبية البيانات.
- تصميم منطقي: اختيار منهجية (Kimball/Inmon)، تحديد الأبعاد والوقائع.
- إعداد Landing وStaging مع مخطط ملفات ومعايير التسمية.
- تنفيذ استخراج/تحويلات أولية، وفحص الجودة.
- اختيار محرك التخزين: مستودع عمودي أو Data Lake + محرك استعلام.
- تصميم التقسيم/التجميع، تحديد المفاتيح البديلة للأبعاد وإستراتيجية SCD.
- إنشاء جداول EDW/المارت، تهيئة الفهارس/الإحصاءات/المواديات.

8) ربط المثال بمجال الروبوتكس (من المخطط التشغيلي لديك)
- أبعاد محتملة: DimFactory, DimProductionLine, DimStation, DimRobot, DimTaskType, DimDate/Time.
- وقائع محتملة: FactProduction (مخرجات/دورات), FactDowntime (الأسباب/المدد), FactRobotTasks (التعيين/الإنجاز), FactSensorReadings (مجمع يومي/ساعي), FactMaintenance (أعطال/إجراءات).
- الحبيبية: حسب الدورة/المهمة/الدقيقة؛ واستخدام تجميعات دورية للجداول الضخمة.

نصيحة عملية
- ابدأ بـ Landing + Staging + EDW بأولوية حقن الدُفعات اليومية، ثم أضف CDC/Streaming تدريجيًا لسيناريوهات شبه آنية.
- استخدم تنسيقات عمودية (Parquet) وتقسيم تاريخي صارم؛ اعتمد أبعاد تاريخية SCD2 للأشياء المتغيرة (مثل الروبوت/المحطة).
- فعّل اختبارات جودة تلقائية قبل التحميل إلى EDW ووثّقها في الكتالوج.